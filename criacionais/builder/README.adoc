:imagesdir: images/
:source-highlighter: highlightjs
:numbered:
:unsafe:
:icons: font

ifdef::env-github[]
:outfilesuffix: .adoc
:caution-caption: :fire:
:important-caption: :exclamation:
:note-caption: :paperclip:
:tip-caption: :bulb:
:warning-caption: :warning:
endif::[]

= Padr√µes de Projetos Criacionais

image:builder.png[title=https://www.clipartmax.com, link=https://www.clipartmax.com]

== Builder (Construtor)

=== Defini√ß√£o

// tag::definicao1[]
üìò"Separa a constru√ß√£o de um objeto complexo da sua representa√ß√£o, de modo que o mesmo processo de constru√ß√£o possa criar diferentes representa√ß√µes." (GoF)
// end::definicao1[]

Em outras palavras, separa o c√≥digo utilizado para a instancia√ß√£o de objetos complexos do c√≥digo da classe de tal objeto. As representa√ß√µes s√£o as inst√¢ncias da classe.

Outra defini√ß√£o diz que 
// tag::definicao2[]
"O padr√£o Builder encapsula a constru√ß√£o de um objeto, permitindo que ele seja constru√≠do em passos." (UCPP)
// end::definicao2[]

=== Distin√ß√£o do Termo

O padr√£o Builder significa construtor, mas n√£o confunda com um m√©todo construtor existente em classes.
Apesar dos dois terem a mesma finalidade ‚Äì construir, instanciar um objeto ‚Äì s√£o mecanismos diferentes utilizados para isso. Um Builder exige o uso de um m√©todo construtor. Ele n√£o consegue instanciar um objeto por si s√≥.

=== Aplicabilidade

O padr√£o pode ser usado pra instanciar um objeto complexo quando:

// tag::aplicabilidade1[]
- A instancia√ß√£o exige muitos par√¢metros no construtor (normalmente bem mais que 3) image:construtor-excesso-params.png[] 
- ... poucos par√¢metros: preceito do Clean Code, favorece Programa√ß√£o Funcional.
// end::aplicabilidade1[]
// tag::aplicabilidade2[]
- A chamada vira uma linha infinita: image:construtor-excesso-params-chamada1.png[]
- E pode ser pior ainda em quest√µes de legibilidade: image:construtor-excesso-params-chamada2.png[]
// end::aplicabilidade2[]
// tag::aplicabilidade3[]
- Poder√≠amos criar construtores sobrecarregados, mas a classe pode crescer muito e desviar o foco image:construtor-sobrecarregado.png[]
// end::aplicabilidade3[]
// tag::aplicabilidade4[]
- H√° depend√™ncia entre atributos: se for definido valor pra _"x"_, precisa definir pra _"y"_.
- Existem atributos obrigat√≥rios e outros opcionais.
- Regras de valida√ß√£o envolvem atributos em conjunto (pra validar _"x"_ √© preciso verificar _"y"_ tamb√©m), etc.
// end::aplicabilidade4[]


Normalmente o primeiro item j√° pode ser o suficiente para aplicarmos o padr√£o Builder a uma classe.

=== Modelagem

.Modelagem do Padr√£o Builder para uma classe fict√≠cia "ClasseComplexa"
image::modelagem-builder.png[]

No diagrama, a classe Builder foi representada como uma _Inner Class_: uma classe declarada dentro de outra. Se o c√≥digo da `ClasseComplexa` for extenso, incluir a Builder como uma _Inner Class_ vai tornar o arquivo mais extenso ainda. Nestes casos, o ideal √© criar a Builder em um arquivo separado.

=== Princ√≠pios utilizados

// tag::principios[]
- https://en.wikipedia.org/wiki/Separation_of_concerns[Separation of Concerns (SoC)] - Separa√ß√£o de Preocupa√ß√µes: separa as regras de neg√≥cio da classe do processo de instancia√ß√£o da mesma.
- Alta Coes√£o
- https://en.wikipedia.org/wiki/GRASP_(object-oriented_design)[General Responsibility Assignment Software Patterns] (GRASP)
// end::principios[]

=== Exemplo de Uso

A figura abaixo apresenta a modelagem do padr√£o Builder para a classe `Produto`.

.Modelagem do padr√£o Builder para uma classe Produto
image::builder-produto.png[]

=== Detalhes de Implementa√ß√£o

// tag::implementacao[]
- M√©todos na classe Builder: sem prefixo, `with` ou `set`
- set √© o padr√£o de IDEs como IntelliJ e NetBeans
- Nome do m√©todo builder: `create()`, `createNomeObjeto()`, `newNomeObjeto()`, `build()` ou `of`
- Construtor _package_ ou _private_
// end::implementacao[]

=== Problemas / Desvantagens

// tag::desvantagens[]
- Duplica√ß√£o absurda de c√≥digo
- Viola o princ√≠pio _Don't Repeat Yourself (DRY)_
- Novos atributos? Precisa atualizar a Builder!
- Exige a cria√ß√£o de um objeto Builder para poder instanciar os objetos desejados
- Dificulta a inje√ß√£o de depend√™ncias
// end::desvantagens[]

=== Solu√ß√µes para Alguns dos Problemas

Implementar o padr√£o Builder √© algo cansativo.
A quantidade de c√≥digo duplicado √© absurda, pois todos
os atributos existentes na classe de modelo ter√° que existir
na classe Builder, assim como todos os setters.
Ao adicionar novos atributos, a classe Builder tem que ser atualizada.
Pra piorar, temos que repetir todo este processo para cada classe
que desejarmos aplicar o padr√£o.

Quando voc√™ implementa o padr√£o como mostrado, voc√™ inclusive estar√° violando o princ√≠pio _Don't Repeat Yourself (DRY)_: N√£o Repita Voc√™ mesmo. Estamos repetindo a declara√ß√£o dos atributos e setters ao criar uma Builder.

Para evitar tais inconvenientes, podemos utilizar IDEs como o IntelliJ e NetBeans para gerar tais Builders automaticamente. https://youtu.be/vjVRDnra8-I[Este v√≠deo] mostra como isso pode ser feito. Neste caso, ao incluir um novo atributo, o mais f√°cil √© excluir a builder e usar o IDE pra cri√°-la novamente.

Alternativamente, podemos usar uma biblioteca que gera uma Builder quando percisarmos, se encarregando de atualizar automaticamente a Builder sempre que atualizarmos a classe de neg√≥cio que ele constr√≥i. Uma biblioteca excelente para isto √© a http://immutables.github.io/factory.html[Immutables], que dentre v√°rios recursos, gera Builders por meio de uma simples anota√ß√£o.

Basta adicionar tal biblioteca no arquivo `pom.xml` e inclui a anota√ß√£o `@Builder.Constructor` no construtor da classe desejada, como `Produto` e pronto: "automagicamente" a classe `ProdutoBuilder` √© criada/atualizada quando compilamos o projeto.

Veja um projeto de exemplo que cria uma builder para uma classe `Paciente` link:paciente-builder-automatico[aqui] (link:https://kinolien.github.io/gitzip/?download=/manoelcampos/padroes-projetos/tree/master/criacionais/builder/paciente-builder-automatico[zip])

== Padr√µes Relacionados

Padr√µes que possuem similaridades ou podem ser usados em conjunto:

- link:../factory-method[Factory Method]

== Exerc√≠cios

Implemente uma classe `Produto` utilizando apenas um construtor sem par√¢metros
e que tenha os seguintes atributos. Os atributos marcados com * s√£o obrigat√≥rios:

- id: long
- *titulo: String
- *descricao: String
- marca: String
- modelo: String
- estoque: int (valor padr√£o zero)
- *preco: double (deve ser maior que zero)
- *dataCadastro: LocalDate (n√£o pode ser menor que a data atual)
- *dataUltimaAtualizacao: LocalDate (n√£o pode ser menor que a data atual)
- urlFoto: String
- *categoria: String
- *vendedor: Vendedor
- peso: double
- altura: double
- largura: double
- profundidade: double

O modelo s√≥ pode ser atribu√≠do se a marca tamb√©m for.
H√° como resolver isso da forma como a implementa√ß√£o foi sugerida acima?

Resolva o problema aplicando o padr√£o Builder, realizando as altera√ß√µes necess√°rias na classe `Produto`.

NOTE: Em uma aplica√ß√£o mais realista, existiriam classes espec√≠ficas como `Marca`, `Modelo`, `Categoria` e outras. Um `Modelo` estaria vinculado a uma `Marca`. Assim, na classe `Produto` ter√≠amos apenas um atributo `Modelo`. Se este for setado, ele deveria estar vinculado a uma `Marca`. Mas este √© apenas um exemplo did√°tico simples, focando apenas na aplica√ß√£o do Builder.